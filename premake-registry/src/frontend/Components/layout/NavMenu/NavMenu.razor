@using Microsoft.JSInterop
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using premake.User
@inject IJSRuntime JS
@inject CurrentUser user;

<nav class="navbar-premake">
    <div class="navbar-container">
        <a href="/" class="navbar-brand">PremakeApp</a>

        <!-- Hamburger toggle -->
        <button class="menu-toggle" @onclick="ToggleMenu" aria-label="Toggle navigation">
            &#9776;
        </button>

        <!-- Links container -->
        <div class="@GetMenuClasses()">
            <a href="/" class="nav-link">Home</a>
            <a href="/docs" class="nav-link">Docs</a>

            @if (user.IsLoggedIn())
            {
                <!-- Avatar button when logged in -->
                <button class="btn-avatar" @onclick="OnAvatarClick">
                    <img src="@user.AvatarUri" alt="User Avatar" class="avatar-img" />
                </button>
            }
            else
            {
                <!-- GitHub login button when not logged in -->
                <button @onclick="() => LoginWithGitHub()" class="btn-github">
                    Login with GitHub
                </button>
            }
        </div>
    </div>
</nav>

@code {
    private bool isMenuOpen;

    private void ToggleMenu()
    {
        isMenuOpen = !isMenuOpen;
        StateHasChanged(); // force re-render
    }

    private string GetMenuClasses()
    {
        return isMenuOpen ? "navbar-links show" : "navbar-links";
    }

    private async Task LoginWithGitHub()
    {
        await JS.InvokeVoidAsync(
            "open",
            "Auth/challenge",
            "_self"
        );
    }

    private void OnAvatarClick()
    {
        // Handle avatar button click (e.g. open profile menu, logout, etc.)
        Console.WriteLine("Avatar clicked!");
    }
}
